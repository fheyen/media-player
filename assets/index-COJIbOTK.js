var Pe=Object.defineProperty;var Re=(e,t,n)=>t in e?Pe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var x=(e,t,n)=>Re(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();function B(){}function ke(e){return e()}function me(){return Object.create(null)}function W(e){e.forEach(ke)}function $e(e){return typeof e=="function"}function re(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Oe(e){return Object.keys(e).length===0}function q(e){return e??""}function E(e,t){e.appendChild(t)}function A(e,t,n){e.insertBefore(t,n||null)}function S(e){e.parentNode&&e.parentNode.removeChild(e)}function ne(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function F(e){return document.createElement(e)}function Q(e){return document.createTextNode(e)}function M(){return Q(" ")}function P(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function $(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Be(e){return Array.from(e.childNodes)}function Te(e,t){t=""+t,e.data!==t&&(e.data=t)}function H(e,t){e.value=t??""}let Y;function z(e){Y=e}function Ee(){if(!Y)throw new Error("Function called outside component initialization");return Y}function Ce(e){Ee().$$.on_mount.push(e)}function De(e){Ee().$$.on_destroy.push(e)}const D=[],se=[];let j=[];const oe=[],Ue=Promise.resolve();let ie=!1;function je(){ie||(ie=!0,Ue.then(Fe))}function le(e){j.push(e)}function We(e){oe.push(e)}const ee=new Set;let C=0;function Fe(){if(C!==0)return;const e=Y;do{try{for(;C<D.length;){const t=D[C];C++,z(t),ze(t.$$)}}catch(t){throw D.length=0,C=0,t}for(z(null),D.length=0,C=0;se.length;)se.pop()();for(let t=0;t<j.length;t+=1){const n=j[t];ee.has(n)||(ee.add(n),n())}j.length=0}while(D.length);for(;oe.length;)oe.pop()();ie=!1,ee.clear(),z(e)}function ze(e){if(e.fragment!==null){e.update(),W(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(le)}}function Ye(e){const t=[],n=[];j.forEach(o=>e.indexOf(o)===-1?t.push(o):n.push(o)),n.forEach(o=>o()),j=t}const K=new Set;let Ge;function J(e,t){e&&e.i&&(K.delete(e),e.i(t))}function ae(e,t,n,o){if(e&&e.o){if(K.has(e))return;K.add(e),Ge.c.push(()=>{K.delete(e)}),e.o(t)}}function U(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Ve(e,t,n){const o=e.$$.props[t];o!==void 0&&(e.$$.bound[o]=n,n(e.$$.ctx[o]))}function Le(e){e&&e.c()}function ue(e,t,n){const{fragment:o,after_update:s}=e.$$;o&&o.m(t,n),le(()=>{const l=e.$$.on_mount.map(ke).filter($e);e.$$.on_destroy?e.$$.on_destroy.push(...l):W(l),e.$$.on_mount=[]}),s.forEach(le)}function ce(e,t){const n=e.$$;n.fragment!==null&&(Ye(n.after_update),W(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function Ke(e,t){e.$$.dirty[0]===-1&&(D.push(e),je(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function fe(e,t,n,o,s,l,f=null,d=[-1]){const u=Y;z(e);const i=e.$$={fragment:null,ctx:[],props:l,update:B,not_equal:s,bound:me(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(u?u.$$.context:[])),callbacks:me(),dirty:d,skip_bound:!1,root:t.target||u.$$.root};f&&f(i.root);let r=!1;if(i.ctx=n?n(e,t.props||{},(m,p,...L)=>{const y=L.length?L[0]:p;return i.ctx&&s(i.ctx[m],i.ctx[m]=y)&&(!i.skip_bound&&i.bound[m]&&i.bound[m](y),r&&Ke(e,m)),p}):[],i.update(),r=!0,W(i.before_update),i.fragment=o?o(i.ctx):!1,t.target){if(t.hydrate){const m=Be(t.target);i.fragment&&i.fragment.l(m),m.forEach(S)}else i.fragment&&i.fragment.c();t.intro&&J(e.$$.fragment),ue(e,t.target,t.anchor),Fe()}z(u)}class de{constructor(){x(this,"$$");x(this,"$$set")}$destroy(){ce(this,1),this.$destroy=B}$on(t,n){if(!$e(n))return B;const o=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return o.push(n),()=>{const s=o.indexOf(n);s!==-1&&o.splice(s,1)}}$set(t){this.$$set&&!Oe(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const qe="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(qe);const ge=new Set(["jpg","jpeg","png","gif","webp"]),pe=new Set(["mp4","flv","mpg","mpeg","webm","3gp","avi"]);function V(e){let t=e.split(/(\[|\])/);return t=t.slice(1,t.length-1).filter(n=>n!==""&&n!=="["&&n!=="]"),t}function te(e){const t=e.split(".");if(!(t.length<2))return t[t.length-1].toLowerCase()}function He(e){let t=e.length,n,o;for(;t;)o=Math.floor(Math.random()*t--),n=e[t],e[t]=e[o],e[o]=n;return e}function Je(e,t){return new URLSearchParams(e.location.search).get(t)}function he(e,t,n){const o=e.slice();return o[6]=t[n],o}function _e(e){let t,n,o;return{c(){t=F("option"),n=Q("tag"),t.__value=o=e[6],H(t,t.__value)},m(s,l){A(s,t,l),E(t,n)},p(s,l){l&1&&o!==(o=s[6])&&(t.__value=o,H(t,t.__value))},d(s){s&&S(t)}}}function Qe(e){let t,n,o,s,l,f,d,u=U(e[0].keys()),i=[];for(let r=0;r<u.length;r+=1)i[r]=_e(he(e,u,r));return{c(){t=F("input"),n=M(),o=F("button"),o.textContent="+",s=M(),l=F("datalist");for(let r=0;r<i.length;r+=1)i[r].c();$(t,"type","text"),$(t,"placeholder","add tag"),$(t,"list","tag-suggestions"),$(l,"id","tag-suggestions")},m(r,m){A(r,t,m),H(t,e[1]),A(r,n,m),A(r,o,m),A(r,s,m),A(r,l,m);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(l,null);f||(d=[P(t,"input",e[5]),P(t,"keydown",e[3]),P(t,"keyup",e[3]),P(t,"keypress",e[3]),P(o,"click",e[2])],f=!0)},p(r,[m]){if(m&2&&t.value!==r[1]&&H(t,r[1]),m&1){u=U(r[0].keys());let p;for(p=0;p<u.length;p+=1){const L=he(r,u,p);i[p]?i[p].p(L,m):(i[p]=_e(L),i[p].c(),i[p].m(l,null))}for(;p<i.length;p+=1)i[p].d(1);i.length=u.length}},i:B,o:B,d(r){r&&(S(t),S(n),S(o),S(s),S(l)),ne(i,r),f=!1,W(d)}}}function Xe(e,t,n){let{tags:o=new Set}=t,{allTags:s=new Map}=t,l="";const f=()=>{console.log("add");const i=l.trim();i.length>0&&(o.add(i),n(4,o=new Set(o))),n(1,l="")},d=i=>{console.log(i),i.stopPropagation(),i.key==="Enter"&&f()};function u(){l=this.value,n(1,l)}return e.$$set=i=>{"tags"in i&&n(4,o=i.tags),"allTags"in i&&n(0,s=i.allTags)},[s,l,f,d,o,u]}class Ze extends de{constructor(t){super(),fe(this,t,Xe,Qe,re,{tags:4,allTags:0})}}function xe(e){let t;return{c(){t=F("div"),t.innerHTML=`<div><span>c</span> choose directory
    <div><span>ü¢Ä</span> / <span>ü¢Ç</span> previous / next item</div> <div><span>ü¢Å</span> / <span>ü¢É</span> 5 seconds backward / forward</div> <div><span>+</span> / <span>-</span> / <span>m</span> volume up / down / muted</div> <div><span>s</span> / <span>f</span> play video slower / faster</div> <div><span>a</span> toggle autoplay</div> <div><span>Delete</span> delete file</div> <div><span>F2</span> rename file</div> <div><span>F5</span> refresh</div> <div><span>F11</span> fullscreen</div> <div>sort:
      <span>1</span> shuffle
      <span>2</span> name
      <span>3</span> date
      <span>4</span> size</div></div>`,$(t,"class","info")},m(n,o){A(n,t,o)},p:B,i:B,o:B,d(n){n&&S(t)}}}class et extends de{constructor(t){super(),fe(this,t,null,xe,re,{})}}const tt="0.1.0";function ve(e,t,n){const o=e.slice();return o[27]=t[n],o}function we(e,t,n){const o=e.slice();return o[27]=t[n],o}function nt(e){let t,n,o,s,l,f,d,u,i,r,m,p,L=U([...e[2]]),y=[];for(let a=0;a<L.length;a+=1)y[a]=ye(we(e,L,a));function R(a){e[7](a)}let O={allTags:e[1]};e[2]!==void 0&&(O.tags=e[2]),f=new Ze({props:O}),se.push(()=>Ve(f,"tags",R));let N=U(e[1].keys()),_=[];for(let a=0;a<N.length;a+=1)_[a]=be(ve(e,N,a));return{c(){t=F("div"),n=F("form"),n.innerHTML='<input id="filterInput" type="text" placeholder="filter by tags" title="Press enter to apply"/>',o=M(),s=F("div");for(let a=0;a<y.length;a+=1)y[a].c();l=M(),Le(f.$$.fragment),u=M(),i=F("div");for(let a=0;a<_.length;a+=1)_[a].c();$(t,"class","filterContainer"),$(s,"class","tags"),$(i,"class","alltags")},m(a,b){A(a,t,b),E(t,n),A(a,o,b),A(a,s,b);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(s,null);A(a,l,b),ue(f,a,b),A(a,u,b),A(a,i,b);for(let T=0;T<_.length;T+=1)_[T]&&_[T].m(i,null);r=!0,m||(p=P(n,"submit",e[5]),m=!0)},p(a,b){if(b[0]&6){L=U([...a[2]]);let w;for(w=0;w<L.length;w+=1){const I=we(a,L,w);y[w]?y[w].p(I,b):(y[w]=ye(I),y[w].c(),y[w].m(s,null))}for(;w<y.length;w+=1)y[w].d(1);y.length=L.length}const T={};if(b[0]&2&&(T.allTags=a[1]),!d&&b[0]&4&&(d=!0,T.tags=a[2],We(()=>d=!1)),f.$set(T),b[0]&7){N=U(a[1].keys());let w;for(w=0;w<N.length;w+=1){const I=ve(a,N,w);_[w]?_[w].p(I,b):(_[w]=be(I),_[w].c(),_[w].m(i,null))}for(;w<_.length;w+=1)_[w].d(1);_.length=N.length}},i(a){r||(J(f.$$.fragment,a),r=!0)},o(a){ae(f.$$.fragment,a),r=!1},d(a){a&&(S(t),S(o),S(s),S(l),S(u),S(i)),ne(y,a),ce(f,a),ne(_,a),m=!1,p()}}}function ye(e){let t,n=e[27]+"",o,s,l,f,d,u;function i(){return e[6](e[27])}return{c(){t=F("button"),o=Q(n),s=M(),$(t,"class",l=q(e[1].get(e[27])<3?"rare":"")+" svelte-1m8kk25"),$(t,"title",f="occurs "+e[1].get(e[27])+" times")},m(r,m){A(r,t,m),E(t,o),E(t,s),d||(u=P(t,"click",i),d=!0)},p(r,m){e=r,m[0]&4&&n!==(n=e[27]+"")&&Te(o,n),m[0]&6&&l!==(l=q(e[1].get(e[27])<3?"rare":"")+" svelte-1m8kk25")&&$(t,"class",l),m[0]&6&&f!==(f="occurs "+e[1].get(e[27])+" times")&&$(t,"title",f)},d(r){r&&S(t),d=!1,u()}}}function be(e){let t,n=e[27]+"",o,s,l,f,d,u;function i(){return e[8](e[27])}return{c(){t=F("button"),o=Q(n),s=M(),$(t,"class",l=q(e[1].get(e[27])<3?"rare":"")+" svelte-1m8kk25"),$(t,"title",f=`${e[27]} ${e[1].get(e[27])} ${(e[1].get(e[27])/e[0].length*100).toFixed(1)}%. Click to add tag to current file.`)},m(r,m){A(r,t,m),E(t,o),E(t,s),d||(u=P(t,"click",i),d=!0)},p(r,m){e=r,m[0]&2&&n!==(n=e[27]+"")&&Te(o,n),m[0]&2&&l!==(l=q(e[1].get(e[27])<3?"rare":"")+" svelte-1m8kk25")&&$(t,"class",l),m[0]&3&&f!==(f=`${e[27]} ${e[1].get(e[27])} ${(e[1].get(e[27])/e[0].length*100).toFixed(1)}%. Click to add tag to current file.`)&&$(t,"title",f)},d(r){r&&S(t),d=!1,u()}}}function st(e){let t,n,o,s,l,f,d,u,i,r,m,p,L,y,R,O,N,_=e[3]&&nt(e);return p=new et({}),{c(){t=F("main"),n=F("div"),n.innerHTML='<div id="progressBar"></div>',o=M(),s=F("div"),l=M(),f=F("div"),d=F("video"),u=M(),i=F("img"),r=M(),_&&_.c(),m=M(),Le(p.$$.fragment),L=M(),y=F("footer"),y.textContent=`v${tt}`,$(n,"id","progress"),$(s,"id","status"),d.autoplay=!0,d.controls=!0,d.loop=!0,d.muted=!0,$(d,"volume",.5),$(f,"class","mediaContainer")},m(a,b){A(a,t,b),E(t,n),E(t,o),E(t,s),E(t,l),E(t,f),E(f,d),E(f,u),E(f,i),E(t,r),_&&_.m(t,null),E(t,m),ue(p,t,null),E(t,L),E(t,y),R=!0,O||(N=[P(d,"mousewheel",it),P(t,"mousewheel",e[4])],O=!0)},p(a,b){a[3]&&_.p(a,b)},i(a){R||(J(_),J(p.$$.fragment,a),R=!0)},o(a){ae(_),ae(p.$$.fragment,a),R=!1},d(a){a&&S(t),_&&_.d(),ce(p),O=!1,W(N)}}}const ot=3e3;function it(e){e.preventDefault(),e.stopPropagation();const t=document.getElementsByTagName("video")[0];e.deltaY<0?t.volume=Math.max(t.volume-.05,0):t.volume=Math.min(t.volume+.01,1)}function lt(e,t,n){const o=Je(window,"tags")!==null;let s=[],l=[],f=new Map,d=new Set,u=0,i=null,r=!1,m=null,p=1;window.showDirectoryPicker||alert("Local file access does not work in this browser!");async function L(){s=[],n(1,f=new Map),i=await window.showDirectoryPicker();for await(const c of i.values())if(c.kind==="file"){const g=te(c.name);(ge.has(g)||pe.has(g))&&s.push(c);let h=V(c.name);for(const v of h)f.has(v)?f.set(v,f.get(v)+1):f.set(v,1)}_(),n(0,l=[...s]),I(s[u])}async function y(c){const g=document.getElementById("filterInput");if(c.target===g)return;new Set(["F2","F5","F11","F12"]).has(c.key)||c.preventDefault();const v=document.getElementsByTagName("video")[0],k=s[u];switch(c.key){case"c":L();break;case"ArrowLeft":w();break;case"ArrowRight":T();break;case"ArrowUp":v.currentTime-=5;break;case"ArrowDown":v.currentTime+=5;break;case"m":v.muted=!v.muted;break;case"-":v.volume=Math.max(v.volume-.05,0);break;case"+":v.volume=Math.min(v.volume+.01,1);break;case"s":v.playbackRate=Math.max(v.playbackRate/2,.125),p=v.playbackRate;break;case"f":v.playbackRate=Math.min(v.playbackRate*2,16),p=v.playbackRate;break;case"a":r=!r,v.loop=!r;break;case"Delete":i&&confirm(`Delete ${k.name}? Cannot be undone!`)&&N(k),s=[...s.slice(0,u),...s.slice(u+1)],I(s[u]);break;case"1":b("shuffle");break;case"2":b("name");break;case"3":b("date");break;case"4":b("size");break;case"F2":let G=k.name;k.name.indexOf("[")>0&&(G=k.name.substring(0,k.name.indexOf("[")));const X=te(k.name),Z=`${G} [${[...d].join("][")}].${X}`;await O(k,Z);break}_()}function R(c){c.preventDefault(),c.stopPropagation();const g=document.getElementsByTagName("video")[0];g.currentTime+=c.deltaY<0?-5:5,g.currentTime>g.duration-1?T():g.currentTime<1&&w()}Ce(()=>{document.body.addEventListener("keydown",y)}),De(()=>{document.body.removeEventListener("keydown",y)});async function O(c,g=null){const h=await c.getFile(),k=await(await window.showSaveFilePicker({suggestedName:g??c.name,startIn:i})).createWritable();await k.write(h),await k.close(),N(c),u=Math.min(u,s.length-1),u>0&&I(s[u])}async function N(c){n(0,l=l.filter(g=>g.name!==c.name)),s.splice(u,1),i.removeEntry(c.name)}async function _(){if(s.length===0)return;const c=s[u].name,g=document.getElementsByTagName("video")[0],h=`${u+1} / ${s.length} files - ${c} - Vol: ${g.muted?"muted":Math.round(g.volume*100)} - Rate: ${p} - ${Math.round(g.currentTime)} / ${Math.round(g.duration)} sec`;document.getElementById("status").innerText=h,document.getElementById("progressBar").style.width=g!=null&&g.duration?g.currentTime/g.duration*100+"%":"0"}async function a(c){c&&c.preventDefault();const h=document.getElementById("filterInput").value.split(" ").map(k=>k.trim()).filter(k=>k.length>0),v=new Set(h);s=l.filter(k=>{const G=V(k.name);{const X=new Set(G);for(const Z of v.values())if(!X.has(Z))return!1;return!0}}),_()}async function b(c){if(c==="name")s.sort((g,h)=>g.name<h.name?-1:1);else if(c==="date"||c==="size"){const g=c==="date"?await Promise.all(s.map(async h=>[await h.getFile().lastModified,h])):await Promise.all(s.map(async h=>[await h.getFile().size,h]));g.sort((h,v)=>h[0]<v[0]?-1:1),s=g.map(h=>h[1])}else c==="shuffle"?He(s):console.error("Invalid sorting mode")}async function T(){u=u>=s.length-1?0:u+1,I(s[u])}async function w(){u=u<=0?s.length-1:u-1,I(s[u])}async function I(c){window.clearTimeout(m);const g=te(c.name);if(!g)throw new Error("No file extension");pe.has(g)?(Se(c),n(2,d=new Set(V(c.name)))):ge.has(g)?(Me(c),n(2,d=new Set(V(c.name)))):alert("Not a image or video file")}async function Se(c){const g=document.getElementsByTagName("img")[0];g.style.display="none";const h=document.getElementsByTagName("video")[0];h.style.display="block";const v=await c.getFile(),k=URL.createObjectURL(v);h.onloadeddata=()=>{h.play()},h.onended=Ae,h.ontimeupdate=_,h.playbackRate=p,h.src=k,h.load()}function Ae(){r&&T()}async function Me(c){const g=document.getElementsByTagName("video")[0];g.style.display="none";const h=document.getElementsByTagName("img")[0];h.style.display="block";const v=await c.getFile(),k=URL.createObjectURL(v);h.onload=()=>{r&&(m=window.setTimeout(T,ot))},h.src=k}const Ne=c=>{confirm("Remove tag?")&&(d.delete(c),n(2,d=new Set(d)))};function Ie(c){d=c,n(2,d)}return[l,f,d,o,R,a,Ne,Ie,c=>{d.add(c),n(2,d=new Set(d))}]}class at extends de{constructor(t){super(),fe(this,t,lt,st,re,{},null,[-1,-1])}}new at({target:document.getElementById("app")});
