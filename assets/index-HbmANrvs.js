var Ke=Object.defineProperty;var qe=(e,t,n)=>t in e?Ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var he=(e,t,n)=>qe(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function n(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(l){if(l.ep)return;l.ep=!0;const a=n(l);fetch(l.href,a)}})();function ee(){}function Ce(e){return e()}function Me(){return Object.create(null)}function Q(e){e.forEach(Ce)}function Be(e){return typeof e=="function"}function De(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function Je(e){return Object.keys(e).length===0}function re(e){return e??""}function c(e,t){e.appendChild(t)}function N(e,t,n){e.insertBefore(t,n||null)}function A(e){e.parentNode&&e.parentNode.removeChild(e)}function we(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function w(e){return document.createElement(e)}function C(e){return document.createTextNode(e)}function E(){return C(" ")}function S(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function M(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Qe(e){return Array.from(e.childNodes)}function Ue(e,t){t=""+t,e.data!==t&&(e.data=t)}function ce(e,t){e.value=t??""}let te;function x(e){te=e}function He(){if(!te)throw new Error("Function called outside component initialization");return te}function Xe(e){He().$$.on_mount.push(e)}function Ze(e){He().$$.on_destroy.push(e)}const K=[],ye=[];let J=[];const be=[],xe=Promise.resolve();let ke=!1;function et(){ke||(ke=!0,xe.then(je))}function Te(e){J.push(e)}function tt(e){be.push(e)}const _e=new Set;let V=0;function je(){if(V!==0)return;const e=te;do{try{for(;V<K.length;){const t=K[V];V++,x(t),nt(t.$$)}}catch(t){throw K.length=0,V=0,t}for(x(null),K.length=0,V=0;ye.length;)ye.pop()();for(let t=0;t<J.length;t+=1){const n=J[t];_e.has(n)||(_e.add(n),n())}J.length=0}while(K.length);for(;be.length;)be.pop()();ke=!1,_e.clear(),x(e)}function nt(e){if(e.fragment!==null){e.update(),Q(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Te)}}function lt(e){const t=[],n=[];J.forEach(i=>e.indexOf(i)===-1?t.push(i):n.push(i)),n.forEach(i=>i()),J=t}const ae=new Set;let it;function $e(e,t){e&&e.i&&(ae.delete(e),e.i(t))}function ze(e,t,n,i){if(e&&e.o){if(ae.has(e))return;ae.add(e),it.c.push(()=>{ae.delete(e)}),e.o(t)}}function q(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ot(e,t,n){const i=e.$$.props[t];i!==void 0&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function st(e){e&&e.c()}function We(e,t,n){const{fragment:i,after_update:l}=e.$$;i&&i.m(t,n),Te(()=>{const a=e.$$.on_mount.map(Ce).filter(Be);e.$$.on_destroy?e.$$.on_destroy.push(...a):Q(a),e.$$.on_mount=[]}),l.forEach(Te)}function Ye(e,t){const n=e.$$;n.fragment!==null&&(lt(n.after_update),Q(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function at(e,t){e.$$.dirty[0]===-1&&(K.push(e),et(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ge(e,t,n,i,l,a,f=null,g=[-1]){const d=te;x(e);const o=e.$$={fragment:null,ctx:[],props:a,update:ee,not_equal:l,bound:Me(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(d?d.$$.context:[])),callbacks:Me(),dirty:g,skip_bound:!1,root:t.target||d.$$.root};f&&f(o.root);let r=!1;if(o.ctx=n?n(e,t.props||{},(p,y,...h)=>{const k=h.length?h[0]:y;return o.ctx&&l(o.ctx[p],o.ctx[p]=k)&&(!o.skip_bound&&o.bound[p]&&o.bound[p](k),r&&at(e,p)),y}):[],o.update(),r=!0,Q(o.before_update),o.fragment=i?i(o.ctx):!1,t.target){if(t.hydrate){const p=Qe(t.target);o.fragment&&o.fragment.l(p),p.forEach(A)}else o.fragment&&o.fragment.c();t.intro&&$e(e.$$.fragment),We(e,t.target,t.anchor),je()}x(d)}class Ve{constructor(){he(this,"$$");he(this,"$$set")}$destroy(){Ye(this,1),this.$destroy=ee}$on(t,n){if(!Be(n))return ee;const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const l=i.indexOf(n);l!==-1&&i.splice(l,1)}}$set(t){this.$$set&&!Je(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const rt="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(rt);const Fe=new Set(["jpg","jpeg","png","gif","webp"]),Se=new Set(["mp4","flv","mpg","mpeg","webm","3gp","avi"]);function se(e){let t=e.split(/(\[|\])/);return t=t.slice(1,t.length-1).filter(n=>n!==""&&n!=="["&&n!=="]"),t}function ve(e){const t=e.split(".");if(!(t.length<2))return t[t.length-1].toLowerCase()}function ct(e){let t=e.length,n,i;for(;t;)i=Math.floor(Math.random()*t--),n=e[t],e[t]=e[i],e[i]=n;return e}function ut(e,t){return new URLSearchParams(e.location.search).get(t)}function Ae(e,t,n){const i=e.slice();return i[6]=t[n],i}function Ne(e){let t,n,i;return{c(){t=w("option"),n=C("tag"),t.__value=i=e[6],ce(t,t.__value)},m(l,a){N(l,t,a),c(t,n)},p(l,a){a&1&&i!==(i=l[6])&&(t.__value=i,ce(t,t.__value))},d(l){l&&A(t)}}}function ft(e){let t,n,i,l,a,f,g,d=q(e[0].keys()),o=[];for(let r=0;r<d.length;r+=1)o[r]=Ne(Ae(e,d,r));return{c(){t=w("input"),n=E(),i=w("button"),i.textContent="+",l=E(),a=w("datalist");for(let r=0;r<o.length;r+=1)o[r].c();M(t,"type","text"),M(t,"placeholder","add tag"),M(t,"list","tag-suggestions"),M(a,"id","tag-suggestions")},m(r,p){N(r,t,p),ce(t,e[1]),N(r,n,p),N(r,i,p),N(r,l,p),N(r,a,p);for(let y=0;y<o.length;y+=1)o[y]&&o[y].m(a,null);f||(g=[S(t,"input",e[5]),S(t,"keydown",e[3]),S(t,"keyup",e[3]),S(t,"keypress",e[3]),S(i,"click",e[2])],f=!0)},p(r,[p]){if(p&2&&t.value!==r[1]&&ce(t,r[1]),p&1){d=q(r[0].keys());let y;for(y=0;y<d.length;y+=1){const h=Ae(r,d,y);o[y]?o[y].p(h,p):(o[y]=Ne(h),o[y].c(),o[y].m(a,null))}for(;y<o.length;y+=1)o[y].d(1);o.length=d.length}},i:ee,o:ee,d(r){r&&(A(t),A(n),A(i),A(l),A(a)),we(o,r),f=!1,Q(g)}}}function dt(e,t,n){let{tags:i=new Set}=t,{allTags:l=new Map}=t,a="";const f=()=>{console.log("add");const o=a.trim();o.length>0&&(i.add(o),n(4,i=new Set(i))),n(1,a="")},g=o=>{console.log(o),o.stopPropagation(),o.key==="Enter"&&f()};function d(){a=this.value,n(1,a)}return e.$$set=o=>{"tags"in o&&n(4,i=o.tags),"allTags"in o&&n(0,l=o.allTags)},[l,a,f,g,i,d]}class mt extends Ve{constructor(t){super(),Ge(this,t,dt,ft,De,{tags:4,allTags:0})}}const gt="0.2.1";function Pe(e,t,n){const i=e.slice();return i[33]=t[n],i}function Ie(e,t,n){const i=e.slice();return i[33]=t[n],i}function pt(e){let t,n,i,l,a,f,g,d,o,r,p,y,h=q([...e[2]]),k=[];for(let u=0;u<h.length;u+=1)k[u]=Re(Ie(e,h,u));function W(u){e[11](u)}let B={allTags:e[1]};e[2]!==void 0&&(B.tags=e[2]),f=new mt({props:B}),ye.push(()=>ot(f,"tags",W));let I=q(e[1].keys()),L=[];for(let u=0;u<I.length;u+=1)L[u]=Oe(Pe(e,I,u));return{c(){t=w("div"),n=w("form"),n.innerHTML='<input id="filterInput" type="text" placeholder="filter by tags" title="Press enter to apply"/>',i=E(),l=w("div");for(let u=0;u<k.length;u+=1)k[u].c();a=E(),st(f.$$.fragment),d=E(),o=w("div");for(let u=0;u<L.length;u+=1)L[u].c();M(t,"class","filterContainer"),M(l,"class","tags"),M(o,"class","alltags")},m(u,$){N(u,t,$),c(t,n),N(u,i,$),N(u,l,$);for(let F=0;F<k.length;F+=1)k[F]&&k[F].m(l,null);N(u,a,$),We(f,u,$),N(u,d,$),N(u,o,$);for(let F=0;F<L.length;F+=1)L[F]&&L[F].m(o,null);r=!0,p||(y=S(n,"submit",e[8]),p=!0)},p(u,$){if($[0]&6){h=q([...u[2]]);let _;for(_=0;_<h.length;_+=1){const P=Ie(u,h,_);k[_]?k[_].p(P,$):(k[_]=Re(P),k[_].c(),k[_].m(l,null))}for(;_<k.length;_+=1)k[_].d(1);k.length=h.length}const F={};if($[0]&2&&(F.allTags=u[1]),!g&&$[0]&4&&(g=!0,F.tags=u[2],tt(()=>g=!1)),f.$set(F),$[0]&7){I=q(u[1].keys());let _;for(_=0;_<I.length;_+=1){const P=Pe(u,I,_);L[_]?L[_].p(P,$):(L[_]=Oe(P),L[_].c(),L[_].m(o,null))}for(;_<L.length;_+=1)L[_].d(1);L.length=I.length}},i(u){r||($e(f.$$.fragment,u),r=!0)},o(u){ze(f.$$.fragment,u),r=!1},d(u){u&&(A(t),A(i),A(l),A(a),A(d),A(o)),we(k,u),Ye(f,u),we(L,u),p=!1,y()}}}function Re(e){let t,n=e[33]+"",i,l,a,f,g,d;function o(){return e[10](e[33])}return{c(){t=w("button"),i=C(n),l=E(),M(t,"class",a=re(e[1].get(e[33])<3?"rare":"")+" svelte-1m8kk25"),M(t,"title",f="occurs "+e[1].get(e[33])+" times")},m(r,p){N(r,t,p),c(t,i),c(t,l),g||(d=S(t,"click",o),g=!0)},p(r,p){e=r,p[0]&4&&n!==(n=e[33]+"")&&Ue(i,n),p[0]&6&&a!==(a=re(e[1].get(e[33])<3?"rare":"")+" svelte-1m8kk25")&&M(t,"class",a),p[0]&6&&f!==(f="occurs "+e[1].get(e[33])+" times")&&M(t,"title",f)},d(r){r&&A(t),g=!1,d()}}}function Oe(e){let t,n=e[33]+"",i,l,a,f,g,d;function o(){return e[12](e[33])}return{c(){t=w("button"),i=C(n),l=E(),M(t,"class",a=re(e[1].get(e[33])<3?"rare":"")+" svelte-1m8kk25"),M(t,"title",f=`${e[33]} ${e[1].get(e[33])} ${(e[1].get(e[33])/e[0].length*100).toFixed(1)}%. Click to add tag to current file.`)},m(r,p){N(r,t,p),c(t,i),c(t,l),g||(d=S(t,"click",o),g=!0)},p(r,p){e=r,p[0]&2&&n!==(n=e[33]+"")&&Ue(i,n),p[0]&2&&a!==(a=re(e[1].get(e[33])<3?"rare":"")+" svelte-1m8kk25")&&M(t,"class",a),p[0]&3&&f!==(f=`${e[33]} ${e[1].get(e[33])} ${(e[1].get(e[33])/e[0].length*100).toFixed(1)}%. Click to add tag to current file.`)&&M(t,"title",f)},d(r){r&&A(t),g=!1,d()}}}function ht(e){let t,n,i,l,a,f,g,d,o,r,p,y,h,k,W,B,I,L,u,$,F,_,P,j,D,Y,ne,X,le,Z,ue,ie,fe,R,de,s,m,v,b,T,z,U,G,Ee,me,oe,ge,Le,O=e[3]&&pt(e);return{c(){t=w("main"),n=w("div"),n.innerHTML='<div id="progressBar"></div>',i=E(),l=w("div"),a=E(),f=w("div"),g=w("video"),d=E(),o=w("img"),r=E(),O&&O.c(),p=E(),y=w("div"),h=w("div"),k=w("div"),k.innerHTML="<span>c</span> choose directory",W=E(),B=w("div"),B.innerHTML="<span>ü¢Ä</span> / <span>ü¢Ç</span> previous / next item",I=E(),L=w("div"),L.innerHTML="<span>ü¢Å</span> / <span>ü¢É</span> 5 seconds backward / forward",u=E(),$=w("div"),$.innerHTML="<span>+</span> / <span>-</span> / <span>m</span> volume up / down / muted",F=E(),_=w("div"),_.innerHTML="<span>s</span> / <span>f</span> play video slower / faster",P=E(),j=w("div"),j.innerHTML="<span>a</span> toggle autoplay",D=E(),Y=w("div"),Y.innerHTML="<span>Delete</span> delete file",ne=E(),X=w("div"),X.innerHTML="<span>F2</span> rename file",le=E(),Z=w("div"),Z.innerHTML="<span>F5</span> refresh",ue=E(),ie=w("div"),ie.innerHTML="<span>F11</span> fullscreen",fe=E(),R=w("div"),de=C(`sort:
        `),s=w("span"),s.textContent="1",m=C(` shuffle
        `),v=w("span"),v.textContent="2",b=C(` name
        `),T=w("span"),T.textContent="3",z=C(` date
        `),U=w("span"),U.textContent="4",G=C(" size"),Ee=E(),me=w("footer"),me.textContent=`v${gt}`,M(n,"id","progress"),M(l,"id","status"),g.autoplay=!0,g.controls=!0,g.loop=!0,g.muted=!0,M(g,"volume",.5),M(f,"class","mediaContainer"),M(y,"class","info")},m(H,pe){N(H,t,pe),c(t,n),c(t,i),c(t,l),c(t,a),c(t,f),c(f,g),c(f,d),c(f,o),c(t,r),O&&O.m(t,null),c(t,p),c(t,y),c(y,h),c(h,k),c(h,W),c(h,B),c(h,I),c(h,L),c(h,u),c(h,$),c(h,F),c(h,_),c(h,P),c(h,j),c(h,D),c(h,Y),c(h,ne),c(h,X),c(h,le),c(h,Z),c(h,ue),c(h,ie),c(h,fe),c(h,R),c(R,de),c(R,s),c(R,m),c(R,v),c(R,b),c(R,T),c(R,z),c(R,U),c(R,G),c(t,Ee),c(t,me),oe=!0,ge||(Le=[S(g,"mousewheel",vt),S(k,"click",e[4]),S(j,"click",e[7]),S(Y,"click",e[6]),S(s,"click",e[13]),S(v,"click",e[14]),S(T,"click",e[15]),S(U,"click",e[16]),S(t,"mousewheel",e[5])],ge=!0)},p(H,pe){H[3]&&O.p(H,pe)},i(H){oe||($e(O),oe=!0)},o(H){ze(O),oe=!1},d(H){H&&A(t),O&&O.d(),ge=!1,Q(Le)}}}const _t=3e3;function vt(e){e.preventDefault(),e.stopPropagation();const t=document.getElementsByTagName("video")[0];e.deltaY<0?t.volume=Math.max(t.volume-.05,0):t.volume=Math.min(t.volume+.01,1)}function wt(e,t,n){const i=ut(window,"tags")!==null;let l=[],a=[],f=new Map,g=new Set,d=0,o=null,r=!1,p=null,y=1;window.showDirectoryPicker||alert("Local file access does not work in this browser!");async function h(){l=[],n(1,f=new Map),o=await window.showDirectoryPicker();for await(const s of o.values())if(s.kind==="file"){const m=ve(s.name);(Fe.has(m)||Se.has(m))&&l.push(s);let v=se(s.name);for(const b of v)f.has(b)?f.set(b,f.get(b)+1):f.set(b,1)}$(),n(0,a=[...l]),d=0,D(l[d])}async function k(s){const m=document.getElementById("filterInput");if(s.target===m)return;new Set(["F2","F5","F11","F12"]).has(s.key)||s.preventDefault();const b=document.getElementsByTagName("video")[0],T=l[d];switch(s.key){case"c":h();break;case"ArrowLeft":j();break;case"ArrowRight":P();break;case"ArrowUp":b.currentTime-=5;break;case"ArrowDown":b.currentTime+=5;break;case"m":b.muted=!b.muted;break;case"-":b.volume=Math.max(b.volume-.05,0);break;case"+":b.volume=Math.min(b.volume+.01,1);break;case"s":b.playbackRate=Math.max(b.playbackRate/2,.125),y=b.playbackRate;break;case"f":b.playbackRate=Math.min(b.playbackRate*2,16),y=b.playbackRate;break;case"a":L(b);break;case"Delete":I();break;case"1":_("shuffle");break;case"2":_("name");break;case"3":_("date");break;case"4":_("size");break;case"F2":let z=T.name;T.name.indexOf("[")>0&&(z=T.name.substring(0,T.name.indexOf("[")));const U=ve(T.name),G=`${z} [${[...g].join("][")}].${U}`;await B(T,G);break}$()}function W(s){s.preventDefault(),s.stopPropagation();const m=document.getElementsByTagName("video")[0];m.currentTime+=s.deltaY<0?-1:1,m.currentTime>m.duration-2?P():m.currentTime<2&&j()}Xe(()=>{document.body.addEventListener("keydown",k)}),Ze(()=>{document.body.removeEventListener("keydown",k)});async function B(s,m=null){const v=await s.getFile(),T=await(await window.showSaveFilePicker({suggestedName:m??s.name,startIn:o})).createWritable();await T.write(v),await T.close(),u(s),d=Math.min(d,l.length-1),d>0&&D(l[d])}function I(){const s=l[d];o&&confirm(`Delete ${s.name}? Cannot be undone!`)&&(u(s),D(l[d]))}function L(s){r=!r,s.loop=!r}async function u(s){n(0,a=a.filter(m=>m.name!==s.name)),l=l.filter(m=>m.name!==s.name),o.removeEntry(s.name)}async function $(){if(l.length===0)return;const s=l[d].name,m=document.getElementsByTagName("video")[0],v=`${d+1} / ${l.length} files - ${s} - Vol: ${m.muted?"muted":Math.round(m.volume*100)} - Rate: ${y} - ${Math.round(m.currentTime)} / ${Math.round(m.duration)} sec`;document.getElementById("status").innerText=v,document.getElementById("progressBar").style.width=m!=null&&m.duration?m.currentTime/m.duration*100+"%":"0"}async function F(s){s&&s.preventDefault();const v=document.getElementById("filterInput").value.split(" ").map(T=>T.trim()).filter(T=>T.length>0),b=new Set(v);l=a.filter(T=>{const z=se(T.name);{const U=new Set(z);for(const G of b.values())if(!U.has(G))return!1;return!0}}),$()}async function _(s){if(s==="name")l.sort((m,v)=>m.name<v.name?-1:1);else if(s==="date"||s==="size"){const m=s==="date"?await Promise.all(l.map(async v=>[await v.getFile().lastModified,v])):await Promise.all(l.map(async v=>[await v.getFile().size,v]));m.sort((v,b)=>v[0]<b[0]?-1:1),l=m.map(v=>v[1])}else s==="shuffle"?ct(l):console.error("Invalid sorting mode")}async function P(){d=d>=l.length-1?0:d+1,D(l[d])}async function j(){d=d<=0?l.length-1:d-1,D(l[d])}async function D(s){window.clearTimeout(p);const m=ve(s.name);if(!m)throw new Error("No file extension");Se.has(m)?(Y(s),n(2,g=new Set(se(s.name)))):Fe.has(m)?(X(s),n(2,g=new Set(se(s.name)))):alert("Not a image or video file")}async function Y(s){const m=document.getElementsByTagName("img")[0];m.style.display="none";const v=document.getElementsByTagName("video")[0];v.style.display="block";const b=await s.getFile(),T=URL.createObjectURL(b);v.onloadeddata=()=>{v.play()},v.onended=ne,v.ontimeupdate=$,v.playbackRate=y,v.src=T,v.load()}function ne(){r&&P()}async function X(s){const m=document.getElementsByTagName("video")[0];m.style.display="none";const v=document.getElementsByTagName("img")[0];v.style.display="block";const b=await s.getFile(),T=URL.createObjectURL(b);v.onload=()=>{r&&(p=window.setTimeout(P,_t))},v.src=T}const le=s=>{confirm("Remove tag?")&&(g.delete(s),n(2,g=new Set(g)))};function Z(s){g=s,n(2,g)}return[a,f,g,i,h,W,I,L,F,_,le,Z,s=>{g.add(s),n(2,g=new Set(g))},()=>_("shuffle"),()=>_("name"),()=>_("date"),()=>_("size")]}class yt extends Ve{constructor(t){super(),Ge(this,t,wt,ht,De,{},null,[-1,-1])}}new yt({target:document.getElementById("app")});
